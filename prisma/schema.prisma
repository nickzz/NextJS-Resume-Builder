generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  password      String?   // For credentials login
  image         String?
  resumes       Resume?
  generatedResumes GeneratedResume[]
}

model Resume {
  id            String        @id @default(cuid())
  userId        String        @unique
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  fullName      String
  position      String
  address       String
  phone         String
  email         String?
  linkedin      String?
  github        String?
  profileImage  String?
  careerSummary String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  certificates  Certificate[]
  educations    Education[]
  experiences   Experience[]
  languages     Language[]
  references    Reference[]
  skills        Skill[]
  generatedResumes GeneratedResume[]
}

model Experience {
  id          String @id @default(cuid())
  resumeId    String
  title       String
  company     String
  startDate   String
  endDate     String
  description String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resume      Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Education {
  id         String @id @default(cuid())
  resumeId   String
  degree     String
  university String
  startYear  String
  endYear    String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  resume     Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Skill {
  id        String @id @default(cuid())
  resumeId  String
  skillType String
  skillName String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resume    Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Certificate {
  id       String @id @default(cuid())
  resumeId String
  certName String
  issuedBy String
  issuedDate   String
  expiryDate  String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Language {
  id          String @id @default(cuid())
  resumeId    String
  language    String
  proficiency String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resume      Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model Reference {
  id       String @id @default(cuid())
  resumeId String
  refName  String
  company  String
  phoneNo  String
  email    String
  position String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
}

model GeneratedResume {
  id          String   @id @default(cuid())
  resumeId    String
  userId      String
  theme       String
  jsonContent Json     // Stores the snapshot of the JSON Resume data
  createdAt   DateTime @default(now())
  resume      Resume   @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
